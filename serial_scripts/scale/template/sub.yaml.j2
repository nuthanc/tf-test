description: vSRX-Scale
heat_template_version: 'rocky'

resources:
  My_IPAM:
    type: OS::ContrailV2::NetworkIpam
    properties:
      name: my-scale-ipam
  

  Sub_VN-0:
    depends_on: [My_IPAM]
    properties:
      name: sub-scale-vn
      network_ipam_refs: [{ get_resource: My_IPAM }]
      network_ipam_refs_data:
        [{
          network_ipam_refs_data_ipam_subnets:
            [{
              network_ipam_refs_data_ipam_subnets_subnet:
                {
                  network_ipam_refs_data_ipam_subnets_subnet_ip_prefix: 27.47.57.0,
                  network_ipam_refs_data_ipam_subnets_subnet_ip_prefix_len: 24,
                },
                network_ipam_refs_data_ipam_subnets_addr_from_start: 'true',
         }]
         },
        ]
    type: OS::ContrailV2::VirtualNetwork

  SubInterface-0:
    depends_on: [Sub_VN-0]
    properties:
      name: sub-interface-0
      virtual_machine_interface_properties: {virtual_machine_interface_properties_sub_interface_vlan_tag: 3}
      virtual_machine_interface_refs: [{{ uuid }}]
      virtual_network_refs: [{ list_join: [':', { get_attr: [ Sub_VN-0, fq_name ] } ] }]
    type: OS::ContrailV2::VirtualMachineInterface

  VMI_sub_IP-0 :
    type: OS::ContrailV2::InstanceIp
    depends_on : [ SubInterface-0, My_VN ]
    properties :
      virtual_machine_interface_refs : [{ get_resource : SubInterface-0 }]
      virtual_network_refs : [{ list_join : [':', { get_attr : [ Sub_VN-0 , fq_name ] } ] }]
      instance_ip_address: 27.47.57.7


